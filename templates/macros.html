{% macro veto_display(feature) %}
  {% if feature.vetoed_by|length > 0 %}
    <s>
      {{ feature.name }}
      {% if feature.amount > 1 %}({{ feature.amount }}x){% endif %}
    </s>
    <span class="veto-users">
      (vetoed by: {{ feature.vetoed_by|join(', ') }})
    </span>
  {% else %}
    {{ feature.name }}
    {% if feature.amount > 1 %}({{ feature.amount }}x){% endif %}
  {% endif %}
{% endmacro %}
{% macro veto_link(feature, unveto_url, veto_url, target_id, username="anonymous", extra_attrs="") %}
  {% if username in (feature.vetoed_by or []) %}
    <a class="unveto-link"
       href="{{ unveto_url }}"
       hx-get="{{ unveto_url }}"
       hx-target="{{ target_id }}"
       hx-swap="outerHTML"
       role="button"
       tabindex="0"
       aria-label="Remove veto from {{ feature.name }}"
       hx-trigger="click, keydown[key=='Enter']"
       {{ extra_attrs|safe }}>unveto</a>
  {% else %}
    <a class="veto-link"
       href="{{ veto_url }}"
       hx-get="{{ veto_url }}"
       hx-target="{{ target_id }}"
       hx-swap="outerHTML"
       role="button"
       tabindex="0"
       aria-label="Veto {{ feature.name }}"
       hx-trigger="click, keydown[key=='Enter']"
       {{ extra_attrs|safe }}>veto</a>
  {% endif %}
{% endmacro %}
{% macro standalone_feature_item(feature, items=None, username="anonymous") %}
  <li class="feature-item">
    <div class="feature-content">
      {{ veto_display(feature) }}
      {{ veto_link(feature,
            "/user/" + username + "/unveto/feature/" + feature.name + "?feature_id=" + feature.id|string,
            "/user/" + username + "/veto/feature/" + feature.name + "?feature_id=" + feature.id|string,
            "#standalone-properties",
            username) }}
    </div>
    <div class="feature-actions">
      {% if items %}
        <form class="move-form">
          <input type="hidden" name="source_item" value="">
          <select name="target_item"
                  class="move-select"
                  hx-post="/move/feature/{{ feature.name }}"
                  hx-trigger="change"
                  hx-target="body"
                  hx-swap="outerHTML"
                  hx-include="closest form"
                  aria-label="Move {{ feature.name }} to a different item">
            <option value="">move...</option>
            {% for item in items %}<option value="{{ item.name }}">{{ item.name }}</option>{% endfor %}
          </select>
        </form>
      {% endif %}
      <button class="delete-button"
              hx-post="/delete/feature/{{ feature.id }}"
              hx-target="body"
              hx-swap="outerHTML"
              aria-label="Delete {{ feature.name }}"
              title="Delete this feature">Ã—</button>
    </div>
  </li>
{% endmacro %}
{% macro item_feature_item_with_move(feature, item_name, items=None, username="anonymous") %}
  <li id="feature-{{ feature.id }}" class="feature-item">
    <div class="feature-content">
      {{ veto_display(feature) }}
      {{ veto_link(feature,
            "/user/" + username + "/unveto/item/" + item_name + "/feature/" + feature.name + "?feature_id=" + feature.id|string,
            "/user/" + username + "/veto/item/" + item_name + "/feature/" + feature.name + "?feature_id=" + feature.id|string,
            "#objects-list",
            username,
            'data-feature-id="' + feature.id|string + '"') }}
    </div>
    <div class="feature-actions">
      {% if items %}
        <form class="move-form">
          <input type="hidden" name="source_item" value="{{ item_name }}">
          <select name="target_item"
                  class="move-select"
                  hx-post="/move/feature/{{ feature.name }}"
                  hx-trigger="change"
                  hx-target="body"
                  hx-swap="outerHTML"
                  hx-include="closest form"
                  aria-label="Move {{ feature.name }} to a different item">
            <option value="">move...</option>
            <option value="">free</option>
            {% for item in items %}
              {% if item.name != item_name %}<option value="{{ item.name }}">{{ item.name }}</option>{% endif %}
            {% endfor %}
          </select>
        </form>
      {% endif %}
      <button class="delete-button"
              hx-post="/delete/feature/{{ feature.id }}"
              hx-target="body"
              hx-swap="outerHTML"
              aria-label="Delete {{ feature.name }}"
              title="Delete this feature">Ã—</button>
    </div>
  </li>
{% endmacro %}
